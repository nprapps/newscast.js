/*! newscast.js - v0.1.0 - 2015-02-02 */
!function(a){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&module.exports?module.exports=a():window.Newscast=a.call(this)}(function(){var a="NEWSCAST",b=new RegExp("(\\S+)"+a+"(.+)$"),c=function(c){var d=c,e=null,f=null,g={},h=function(a,b){c.debug&&(b||(a="Newscast.Receiver: "+a),console.log(a))},i=function(a){f=a.data.launchingSenderId,h("Got sender id: "+f)},j=function(a){h("Received message: "+a.data);var c=a.data.match(b),d=c[1],e=c[2];k(d,e)},k=function(a,b){if(a in g)for(var c=0;c<g[a].length;c++)g[a][c](b)},l=function(a,b){a in g||(g[a]=[]),g[a].push(b)},m=function(b,c){c=b+a+c,h("Sending message: "+c),e.send(f,c)};h("Initializing receiver");var n=cast.receiver.CastReceiverManager.getInstance();return e=n.getCastMessageBus(d.namespace),n.onReady=i,e.onMessage=j,n.start(),{onMessage:l,sendMessage:m}},d=function(c){var d=c,e=null,f={},g=function(a,b){c.debug&&(b||(a="Newscast.Sender: "+a),console.log(a))},h=function(a){g("Session created"),e=a,e.addUpdateListener(i),c.onSenderStarted&&c.onSenderStarted()},i=function(a){a||(g("Session no longer alive"),c.onSenderStopped&&c.onSenderStopped())},j=function(a){a===chrome.cast.ReceiverAvailability.AVAILABLE?(g("Receiver is available"),c.onSenderReady&&c.onSenderReady()):a===chrome.cast.ReceiverAvailability.UNAVAILABLE&&(g("Receiver not available"),g(a,!0))},k=function(){g("Chromecast initialized")},l=function(a){g("Chromecast initialization failed, error:"),g(a,!0)},m=function(){g("Starting cast"),chrome.cast.requestSession(n,o)},n=function(a){g("Session created"),e=a,e.addUpdateListener(i),e.addMessageListener(d.namespace,s),d.onSenderStarted&&d.onSenderStarted()},o=function(a){g("Failed to create session, error:"),g(a,!0)},p=function(){g("Stopping cast"),e.stop(q,r)},q=function(){g("Cast stopped"),c.onSenderStopped&&c.onSenderStopped()},r=function(a){g("Failed to stop cast, error:"),g(a,!0)},s=function(a,c){g("Received message: "+c);var d=c.match(b),e=d[1],f=d[2];t(e,f)},t=function(a,b){if(a in f)for(var c=0;c<f[a].length;c++)f[a][c](b)},u=function(a,b){a in f||(f[a]=[]),f[a].push(b)},v=function(b,d){d=b+a+d,g("Sending message: "+d),e.sendMessage(c.namespace,d,w,x)},w=function(){g("Message sent")},x=function(a){g("Failed to send message, error:"),g(a,!0)};g("Initializing sender");var y=new chrome.cast.SessionRequest(c.appId),z=new chrome.cast.ApiConfig(y,h,j,chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED);return chrome.cast.initialize(z,k,l),{startCasting:m,stopCasting:p,sendMessage:v,onMessage:u}},e=function(a){var b=a;a.hasOwnProperty("isReceiver")||(a.isReceiver=window.location.search.indexOf("newscast-receiver=true")>=0);var e=function(b,c){a.debug&&(c||(b="Newscast.Newcast: "+b),console.log(b))},f=document.createElement("script");f.async=!1,f.type="text/javascript",a.isReceiver?(f.src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js",f.onload=function(){var d=new c(b);a.onReceiverCreated(d)},document.body.appendChild(f)):(window.__onGCastApiAvailable=function(c,f){if(c){var g=new d(b);a.onSenderCreated(g)}else e("Failed to load Chromecast library, error:"),e(f,!0)},f.src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js",document.body.appendChild(f))};return{Receiver:c,Sender:d,Newscast:e}});